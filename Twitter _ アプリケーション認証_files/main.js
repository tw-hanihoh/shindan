provide("util/util",function(e){function t(e){return e&&String(e).toLowerCase().indexOf("[native code]")>-1}function n(e){return o(arguments,function(t){s(t,function(t,n){e[t]=n})}),e}function r(e){return s(e,function(t,n){v(n)&&(r(n),m(n)&&delete e[t]),(n===undefined||n===null||n==="")&&delete e[t]}),e}function s(e,t){for(var n in e)(!e.hasOwnProperty||e.hasOwnProperty(n))&&t(n,e[n]);return e}function c(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function h(e,t){return e==c(t)}function p(e,t,n){return n=n||[],function(){var r=a(arguments,function(e){return e});return e.apply(t,n.concat(r))}}function v(e){return e===Object(e)}function m(e){if(!v(e))return!1;if(Object.keys)return!Object.keys(e).length;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function g(e,t){window.setTimeout(function(){e.call(t||null)},0)}function y(e){return Array.prototype.slice.call(e)}var i=function(){var e=Array.prototype.indexOf;return t(e)?function(t,n){return t?e.apply(t,[n]):-1}:function(e,t){if(!e)return-1;for(var n=0,r=e.length;n<r;n++)if(t==e[n])return n;return-1}}(),o=function(){var e=Array.prototype.forEach;return t(e)?function(t,n){if(!t)return;if(!n)return;e.apply(t,[n])}:function(e,t){if(!e)return;if(!t)return;for(var n=0,r=e.length;n<r;n++)t(e[n],n)}}(),u=function(){var e=Array.prototype.filter;return t(e)?function(t,n){return t?n?e.apply(t,[n]):t:null}:function(e,t){if(!e)return null;if(!t)return e;var n=[],r=0,i=e.length;for(;r<i;r++)t(e[r])&&n.push(e[r]);return n}}(),a=function(){var e=Array.prototype.map;return t(e)?function(t,n){return t?n?e.apply(t,[n]):t:null}:function(e,t){if(!e)return null;if(!t)return e;var n=[],r=0,i=e.length;for(;r<i;r++)n.push(t(e[r]));return n}}(),f=function(){var e=Array.prototype.reduce;return t(e)?function(t,n,r){return t?n?e.apply(t,[n,r]):r:null}:function(e,t,n){if(!e)return null;if(!t)return n;var r=n,i=0,s=e.length;for(;i<s;i++)r=t(r,e[i],i,e);return r}}(),l=function(){var e=String.prototype.trim;return t(e)?function(t){return t&&e.apply(t)}:function(e){return e&&e.replace(/(^\s+|\s+$)/g,"")}}(),d=t(Object.create)?Object.create:function(e){function t(){}return t.prototype=e,new t};e({aug:n,async:g,compact:r,forIn:s,forEach:o,filter:u,map:a,reduce:f,trim:l,indexOf:i,isNative:t,isObject:v,isEmptyObject:m,createObject:d,bind:p,toType:c,isType:h,toRealArray:y})});
provide("util/events",function(e){using("util/util",function(t){var n={bind:function(e,t){return this._handlers=this._handlers||{},this._handlers[e]=this._handlers[e]||[],this._handlers[e].push(t)},unbind:function(e,n){if(!this._handlers[e])return;if(n){var r=t.indexOf(this._handlers[e],n);r>=0&&this._handlers[e].splice(r,1)}else this._handlers[e]=[]},trigger:function(e,n){var r=this._handlers&&this._handlers[e];n.type=e,t.forEach(r,function(e){t.async(t.bind(e,this,[n]))})}};e({Emitter:n})})});
provide("xd/jsonrpc",function(e){using("util/util","util/events",function(t,n){function r(e){return(JSON.parse||JSON.decode)(e)}function i(e){this.con=e}function s(){this.id=s.id++}function o(){e(function(e){return new i(e)})}t.aug(i.prototype,{expose:function(e){this.con.bind("message",this._handleRequest(e))},call:function(e){var t=this,n;return this._requests||(this._requests={},this.con.bind("message",function(e){var n;try{e=r(e)}catch(i){return}if(!e.callback)return;typeof e.id=="number"&&(n=t._requests[e.id])&&(e.error?n.trigger("error",e):n.trigger("success",e),delete t._requests[e.id])})),n=new s,this._requests[n.id]=n,n.send(this.con,e,Array.prototype.slice.call(arguments,1))},_handleRequest:function(e){var t=this;return function(i){var s,o;try{i=r(i)}catch(u){return}if(i.callback)return;typeof i.id=="number"&&typeof e[i.method]=="function"&&(o=t._responseCallbacks(i.id),s=e[i.method].apply(e,i.params.concat(o)),typeof s!="undefined"&&o[0](s))}},_responseCallbacks:function(e){var t=this.con;return[function(r){t.send(JSON.stringify({id:e,result:r,callback:!0}))},function n(r){t.send(JSON.stringify({id:e,error:n,callback:r}))}]}}),s.id=0,t.aug(s.prototype,n.Emitter,{send:function(e,t,n){return e.send(JSON.stringify({id:this.id,method:t,params:n})),this},success:function(e){return this.bind("success",e),this},error:function(e){return this.bind("error",e),this}}),typeof JSON!="undefined"&&o()})});
provide("xd/flash",function(e){function t(e,t){var n=t||Math.floor(Math.random()*100),r=['<object id="xdflashshim'+n+'" name="xdflashshim'+n+'"','type="application/x-shockwave-flash" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"','width="1" height="1" style="position:absolute;left:-9999px;top:-9999px;">','<param name="movie" value="'+e+"&debug="+window.__XDDEBUG__+'">','<param name="wmode" value="window">','<param name="allowscriptaccess" value="always">',"</object>"].join(" ");return r}e({object:t})});
provide("dom/cookie",function(e){using("util/util",function(t){e(function(e,n,r){var i=t.aug({},r),s,o,u,a;if(arguments.length>1&&String(n)!=="[object Object]"){if(n===null||n===undefined)i.expires=-1;return typeof i.expires=="number"&&(s=i.expires,o=new Date((new Date).getTime()+s*60*1e3),i.expires=o),n=String(n),document.cookie=[encodeURIComponent(e),"=",i.raw?n:encodeURIComponent(n),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}return i=n||{},a=i.raw?function(e){return e}:decodeURIComponent,(u=(new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)")).exec(document.cookie))?a(u[1]):null})})});
provide("util/typevalidator",function(e){using("util/util",function(t){function n(e){return e!==undefined&&e!==null&&e!==""}function r(e){return s(e)&&e%1===0}function i(e){return s(e)&&!r(e)}function s(e){return n(e)&&!isNaN(e)}function o(e){return n(e)&&t.toType(e)=="array"}function u(e){if(!n(e))return!1;switch(e){case"on":case"ON":case"true":case"TRUE":return!0;case"off":case"OFF":case"false":case"FALSE":return!1;default:return!!e}}function a(e){if(s(e))return e}function f(e){if(i(e))return e}function l(e){if(r(e))return e}e({hasValue:n,isInt:r,isFloat:i,isNumber:s,isArray:o,asInt:l,asFloat:f,asNumber:a,asBoolean:u})})});
provide("tfw/util/globals",function(e){using("util/typevalidator",function(t){function r(){var e=document.getElementsByTagName("meta"),t,r,i=0;n={};for(;t=e[i];i++){if(!/^twitter:/.test(t.name))continue;r=t.name.replace(/^twitter:/,""),n[r]=t.content}}function i(e){return n[e]}function s(e){return t.asBoolean(e)&&(n.dnt=!0),t.asBoolean(n.dnt)}var n;r(),e({init:r,val:i,dnt:s})})});
provide("util/logger",function(e){using("util/util",function(t){function s(){c("info",t.toRealArray(arguments))}function o(){c("warn",t.toRealArray(arguments))}function u(){c("error",t.toRealArray(arguments))}function a(e){if(!i)return;r[e]=l()}function f(e){var t;if(!i)return;r[e]?(t=l(),s("_twitter",e,t-r[e])):u("timeEnd() called before time() for id: ",e)}function l(){return window.performance&&+window.performance.now()||+(new Date)}function c(e,t){if(!window[n]||!window[n][e])return;switch(t.length){case 1:window[n][e](t[0]);break;case 2:window[n][e](t[0],t[1]);break;case 3:window[n][e](t[0],t[1],t[2]);break;case 4:window[n][e](t[0],t[1],t[2],t[3]);break;case 5:window[n][e](t[0],t[1],t[2],t[3],t[4]);break;default:t.length!==0&&window[n].warn&&window[n].warn("too many params passed to logger."+e)}}var n=["con","sole"].join(""),r={},i=!!~location.href.indexOf("tw_debug=true");e({info:s,warn:o,error:u,time:a,timeEnd:f})})});
provide("util/domready",function(e){function c(){t=1;for(var e=0,r=n.length;e<r;e++)n[e]()}var t=0,n=[],r,i,s=!1,o=document.createElement("a"),u="DOMContentLoaded",a="addEventListener",f="onreadystatechange",l;/^loade|c/.test(document.readyState)&&(t=1),document[a]&&document[a](u,i=function(){document.removeEventListener(u,i,s),c()},s),o.doScroll&&document.attachEvent(f,r=function(){/^c/.test(document.readyState)&&(document.detachEvent(f,r),c())}),l=o.doScroll?function(e){window.self!=window.top?t?e():n.push(e):!function(){try{o.doScroll("left")}catch(t){return setTimeout(function(){l(e)},50)}e()}()}:function(e){t?e():n.push(e)},e(l)});
provide("util/env",function(e){using("util/domready","util/typevalidator","util/logger","tfw/util/globals",function(t,n,r,i){function f(e){return e=e||window,e.devicePixelRatio?e.devicePixelRatio>=1.5:e.matchMedia?e.matchMedia("only screen and (min-resolution: 144dpi)").matches:!1}function l(e){return e=e||s,/(Trident|MSIE \d)/.test(e)}function c(e){return e=e||s,/MSIE 6/.test(e)}function h(e){return e=e||s,/MSIE 7/.test(e)}function p(e){return e=e||s,/MSIE 9/.test(e)}function d(e){return e=e||s,/(iPad|iPhone|iPod)/.test(e)}function v(e){return e=e||s,/^Mozilla\/5\.0 \(Linux; (U; )?Android/.test(e)}function m(){return o}function g(e,t){return e=e||window,t=t||s,e.postMessage&&(!l(t)||!e.opener)}function y(e){e=e||navigator;try{return!!e.plugins["Shockwave Flash"]||!!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(t){return!1}}function b(e,t,n){return e=e||window,t=t||navigator,n=n||s,"ontouchstart"in e||/Opera Mini/.test(n)||t.msMaxTouchPoints>0}function w(){var e=document.body.style;return e.transition!==undefined||e.webkitTransition!==undefined||e.mozTransition!==undefined||e.oTransition!==undefined||e.msTransition!==undefined}var s=window.navigator.userAgent,o=!1,u=!1,a="twitter-csp-test";window.twttr=window.twttr||{},twttr.verifyCSP=function(e){var t=document.getElementById(a);u=!0,o=!!e,t&&t.parentNode.removeChild(t)},t(function(){var e;if(c()||h())return o=!1;if(n.asBoolean(i.val("widgets:csp")))return o=!0;e=document.createElement("script"),e.id=a,e.text="twttr.verifyCSP(false);",document.body.appendChild(e),window.setTimeout(function(){if(u)return;r.warn('TWITTER: Content Security Policy restrictions may be applied to your site. Add <meta name="twitter:widgets:csp" content="on"> to supress this warning.'),r.warn("TWITTER: Please note: Not all embedded timeline and embedded Tweet functionality is supported when CSP is applied.")},5e3)}),e({retina:f,anyIE:l,ie6:c,ie7:h,ie9:p,ios:d,android:v,cspEnabled:m,flashEnabled:y,canPostMessage:g,touch:b,cssTransitions:w})})});
provide("xd/base",function(e){using("util/util","util/events",function(t,n){function r(){}t.aug(r.prototype,n.Emitter,{transportMethod:"",init:function(){},send:function(e){var t;this._ready?this._performSend(e):t=this.bind("ready",function(){this.unbind("ready",t),this._performSend(e)})},ready:function(){this.trigger("ready",this),this._ready=!0},isReady:function(){return!!this._ready},receive:function(e){this.trigger("message",e)}}),e({Connection:r})})});
provide("xd/child",function(e){using("xd/base","util/util","util/env","dom/cookie","xd/flash",function(t,n,r,i,s){function f(){this.transportMethod="PostMessage",this.parent=window.opener||window.parent,this.init()}function l(e){this.transportMethod="Flash",this.options=e,this.token=this._getToken(),this.init()}function c(){this.transportMethod="Fallback"}var o="__ready__",u=/[&?]xd_token\=([0-9a-f]+)/,a={_getToken:function(){var e=location.search,t=e.match(u),n=!1;return t&&t.length>1?(n=t[1],this._save(window.name,n)):n=this._load(window.name),n},_load:function(e){return i(e)},_save:function(e,t){return i(e,t)}};f.prototype=new t.Connection,n.aug(f.prototype,{init:function(){var e=this;window.addEventListener?window.addEventListener("message",function(t){e.receive(t.data)},!1):window.attachEvent("onmessage",function(t){e.receive(t.data)}),this.ready(),this.send(o)},_performSend:function(e){var t=this;setTimeout(function(){t.parent.postMessage(e,"*")},1)}}),l.prototype=new t.Connection,n.aug(l.prototype,a,{init:function(){var e=this,t;window["__xdcb"+e.token]={receive:function(t){e.receive(t)},loaded:function(){(function t(){e.proxy?(e.send(o),e.ready()):setTimeout(t,10)})()}},t=document.createElement("div"),t.innerHTML=s.object("//platform.twitter.com/xd/ft.swf?callback=__xdcb"+e.token+"&token="+e.token,e.token),document.body.appendChild(t),e.proxy=t.firstChild},_performSend:function(e){this.proxy.send(e)}}),c.prototype=new t.Connection,n.aug(c.prototype,{init:function(){},_performSend:function(){}}),e({connect:function(){return r.canPostMessage()?new f:r.anyIE()&&r.flashEnabled()?new l:new c}})})});
provide("tfw/intents/main",function(e){using("util/util","imports/jquery","xd/child","xd/jsonrpc",function(t,n,r,i){window.self==window.top&&(document.body.className+=" js",document.documentElement.style.display="block");var s={keyCodes:{enter:13,escape:27,esc:27,tab:9,spacebar:32,upArrow:38,downArrow:40}},o="#username_or_email, #password",u;n(document).ready(function(){function a(e){n(e).parents(".row").toggleClass("content",e.value.length>0)}var t=r.connect();e({trigger:function(e,n){var r=i(t).call("trigger",e,n);window.twttr&&window.twttr.tfw&&window.twttr.tfw.autoCloseTimeout&&(clearTimeout(window.twttr.tfw.autoCloseTimeout),r.success(function(){window.close()}))}}),n(o).bind("keyup blur",function(){a(this)}),setInterval(function(){n(o).each(function(){a(this)})},500),n("label").click(function(){this.htmlFor&&document.getElementById(this.htmlFor).focus()}),0=="autofocus"in document.createElement("input")&&n("input, textarea").each(function(e,t){if(t.getAttribute("autofocus"))return t.focus(),!1}),u=n("#session"),n(document).bind({click:function(e){var t=n(".user-menu").get(0),r=n(".current-user a").get(0);if(!t&&!r)return;e.target===r||n.contains(r,e.target)?(e.preventDefault(),u.hasClass("show")?u.removeClass("show").removeClass("opt"):(e.altKey&&u.addClass("opt"),u.toggleClass("show"))):e.target!==t&&!n.contains(t,e.target)&&n("#session").removeClass("show").removeClass("opt")},keyup:function(e){e.keyCode===s.keyCodes.escape&&n("#session").removeClass("show").removeClass("opt")}}),window.opener&&(n("a").each(function(){var e=n(this);if(this.href.match(/^https?:\/\/([a-z0-9.\-]+\.)?([a-z0-9.\-]+\.)?twitter\.com(:[0-9]+)?\/(share|intent)/)||e.hasClass("maintain-context"))return;this.target="_blank",e.hasClass("exit")&&e.click(function(){window.close()}),e.hasClass("alternate-context")&&e.click(function(){setTimeout(function(){window.close()},500)})}),n(".button.cancel").click(function(){return window.close(),!1}),n(document.body).hasClass("autoclose")&&(window.twttr||(window.twttr={}),window.twttr.tfw||(window.twttr.tfw={}),window.twttr.tfw.autoCloseTimeout=setTimeout(function(){window.close()},1300))),n(".follow-button").bind("mouseleave blur",function(){n(this).removeClass("followed")})})})})